version: "3.3"

networks:
  speedtest:
    external: false
  documentation:
    external: true
  
volumes:
  speedtest_data:
    driver: local
  etc-pihole:
    driver: local
  etc-dnsmasq.d:
    driver: local
  appflowy-data:
    driver: local

services:
  speedtest:
    container_name: speedtest
    image: henrywhitaker3/speedtest-tracker:latest
    networks:
      - speedtest
    ports:
        - 8765:80
    volumes:
        - speedtest_data:/config
    environment:
        - TZ=$TZ
        - PGID=$USER_UID
        - PUID=$USER_UID
        - OOKLA_EULA_GDPR=true
    logging:
        driver: "json-file"
        options:
            max-file: "10"
            max-size: "200k"
    restart: unless-stopped

  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    ports:
      - "5353:53/tcp"
      - "5353:53/udp"
      - "7788:80/tcp"
    environment:
      TZ: $TZ
      WEBPASSWORD: $WEB_Password # 'set a secure password here or it will be random'
    # Volumes store your data between container upgrades
    volumes:
      - etc-pihole:/etc/pihole
      - etc-dnsmasq.d:/etc/dnsmasq.d
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
    cap_add:
      - NET_ADMIN # Required if you are using Pi-hole as your DHCP server, else not needed
    restart: unless-stopped
    
  appflowy:
    image: appflowyio/appflowy_client:main
    container_name: appflowyio
    environment:
      TZ: $TZ
      DISPLAY: $DISPLAY # 'set a secure password here or it will be random'
    # Volumes store your data between container upgrades
    volumes:
      - $HOME/.Xauthority:/root/.Xauthority:rw
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /dev/dri:/dev/dri
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket
      - appflowy-data:/home/appflowy
    restart: unless-stopped
